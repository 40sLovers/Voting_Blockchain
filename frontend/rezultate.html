<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- <link rel="stylesheet" type="text/css" href="css/bootstrap-grid.css"> -->
  <link href="css/bootstrap-4.4.1.css" rel="stylesheet" type="text/css" />
  <!-- <script src="js/bootstrap.bundle.js"></script> -->
  <script src="js/bootstrap-4.4.1.js" type="text/javascript"></script>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <link rel="stylesheet" href="css/style.css" type="text/css" media="all" />
  <link rel="stylesheet" href="css/animatie.css" type="text/css" media="all" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Libre+Baskerville&family=Raleway:wght@400;500&family=Roboto&display=swap"
    rel="stylesheet">
  <script src="Scripts/swfobject_modified.js" type="text/javascript"></script>
</head>

<body class="noScroll">
    <div>
        <div id="container">
            <div class="menu">
                <img src="images/logo.svg" height="72px" />
                <div class="nameLogo">VoteBoat</div>
            </div><!-- End of Nav Div -->
            <div class="header">


                <!-- Pagina de rezultate -->

                <div id="continut1">
                    <div id="continutRezultate">
                        <h1>Rezultate</h1>
                        <h3><span id="titlu"></span></h3>
                        <hr>
                        <p><span id="descriere"></span></p>
                        <h5>DiagramÄƒ</h5>
                        

                        <!-- Container chart -->
                        <div>

                            <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
                            <canvas id="chart_voturi">
                        </div>
                        
                        <h5>Detalii</h5>
                        <div id="continutRezultate_detalii">
                            <p>Nr. total de voturi: <span id="nrTotalVoturi">test</span> </p>
                            <p>Voturi</p>
                            <p><span id="listaItemi"></span></p>
                            <p><b><span id="castigator"></span></b></p>
                        </div>


                        <!-- Chart script -->
                        <script>
                                                        
                            // exemplu pentru query parameters
                            // ?vot_titlu=Alegeri pentru postul de manager&vot_descriere=Acest vot a fost creat cu scopul de a alege noul manager al echipei.&vot_itemi=["Ion",%20"Maria"]&vot_numar=[325,412]

                            let urlParams = new URLSearchParams(window.location.search);


                            // ----Titlul si descrierea votului----
                            let vot_titlu       = urlParams.get('vot_titlu');
                            let vot_descriere   = urlParams.get('vot_descriere');

                            document.getElementById('titlu').innerText      = vot_titlu;
                            document.getElementById('descriere').innerText  = vot_descriere;


                            // ----Afisarea tabelului----
                            // Chart.js
                            let chart = document.getElementById('chart_voturi').getContext('2d');

                            let vot_itemi   = urlParams.get('vot_itemi');
                            let vot_numar   = urlParams.get('vot_numar');
                            vot_itemi       = JSON.parse(vot_itemi);
                            vot_numar       = JSON.parse(vot_numar);

                            
                            let votesChart = new Chart(chart, {
                                type:'bar',
                                data:{
                                    labels:vot_itemi,
                                    datasets:[{
                                        label:'Voturi',
                                        data:vot_numar,

                                        backgroundColor: [
                                            'rgba(89, 133, 255, 0.5)',
                                            'rgba(255, 89, 133, 0.5)',
                                        ],
                                    }],
                                },
                                options: {
                                    plugins: {
                                        title: {
                                            display: true,
                                            text: 'Rezultatele votului',
                                            font:{size:18},
                                            padding:{top:30, bottom:20},
                                            color:'#182552'
                                        },
                                        legend:{
                                            display:false
                                        }
                                    }
                                }
                            })


                            // ----Calcularea voturilor----

                            // Numarul total de voturi
                            var nrTotalVoturi = 0;

                            for(let i in vot_numar)
                                nrTotalVoturi += vot_numar[i];

                            document.getElementById("nrTotalVoturi").innerText = String(nrTotalVoturi);


                            // Numarul de voturi pentru fiecare item

                            var list = document.createElement('ul');

                            for (var i = 0; i < vot_itemi.length; i++) {
                                var item = document.createElement('li');
                                item.appendChild(document.createTextNode(vot_itemi[i]+": "+vot_numar[i]));
                                list.appendChild(item);
                            }

                            document.getElementById('listaItemi').appendChild(list);


                            // Determinare castigator
                            var indexCastigator = vot_numar.findIndex((element) => element == Math.max(...vot_numar))

                            document.getElementById('castigator').innerText = "Castigator: " + vot_itemi[indexCastigator];


                        </script>
                        <!-- End of Chart script -->



                    </div>
                </div>


                <!--Waves Container-->
                <div>
                    <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                        viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
                        <defs>
                            <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
                        </defs>
                        <g class="parallax">
                            <use xlink:href="#gentle-wave" x="48" y="0" fill="rgba(255,255,255,0.7)" />
                            <use xlink:href="#gentle-wave" x="48" y="3" fill="rgba(255,255,255,0.5)" />
                            <use xlink:href="#gentle-wave" x="48" y="5" fill="rgba(255,255,255,0.3)" />
                            <use xlink:href="#gentle-wave" x="48" y="7" fill="#fff" />
                        </g>
                    </svg>
                </div>
            </div>
            
                <!--Waves end aici a fost Denis-->

        </div>
    </div> 
    <!--Header ends-->
    <!-- partial -->
    <script type="text/javascript">
  //<!--
  //swfobject.registerObject("FLVPlayer");
  //-->
    </script>
</body>

</html>